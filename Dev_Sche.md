 🙋‍♀️🙋‍♂️🙋👨‍💼

## 🗓️0703~0704

#### 🙋‍♀️정은지

[07/03]
**초기 모델 개발**
- 데이터셋 확보 및 전처리:
   - 데이터 소스: Kaggle, roboflow, AI Hub를 통한 UTKFace 등 얼굴 이미지 데이터셋 탐색 및 수집.
   - 직면 과제:
      - 데이터 불균형: 서양인 자료 비중이 높아 동양인 나이 분류 정확도 저하.
      - 용량 문제: 동양인 전용 파일의 과도한 용량으로 인한 처리 부담.
      - 형식 비일관성: 상이한 파일 형식으로 인한 통합 및 전처리 과정의 난항.
      - 결과: 위 이슈들로 인한 고품질 데이터 선별의 어려움 발생.
- 다양한 딥러닝 모델 학습 및 성능 비교:
   - 활용 모델: VGG16, ResNet50V2, ResNet152V2, Xception, InceptionV3, MobileNetV3Small, MobileNetV3Large 등 총 7가지 딥러닝 모델 활용 학습 진행.
   - 성능 지표: 각 모델의 손실(Loss) 및 정확도(Accuracy) 변화 모니터링을 통한 성능 비교 및 최적 모델 탐색.
  
[07/04]
**평가챗봇 시스템 구축**
- 챗봇 시스템 구현:
   - Ollama gemma3 1b 모델 설치를 통한 외부 서버 챗봇 시스템 성공적 구현.
- 초기 모델 학습 및 검증:
   - 데이터셋: 1,000개 이미지 데이터셋 활용.
   - 모델 구성:
      - 나이 추론: VGG16 모델 적용.
      - 성별 추론: ResNet152V2 모델 적용.
   - 환경: Keras 프레임워크 기반 모델의 라즈베리 파이 임베딩 및 웹캠을 통한 실시간 동작 확인.


#### 🙋‍♂️이은성
- 얼굴 이미지 데이터셋을 여러 경로로 수집 (이미지 크기 조정, 얼굴 영역 추출 등 전처리 작업)
   - 나이와 성별 정보를 라벨링 데이터 다양성을 높이기 위해 이미지 회전, 크롭, 밝기 조절 등 데이터 증강 기법을 적용. 
- 초기 CNN 모델 사용 시, 얼굴 이미지의 복잡한 특징 반영 부족, 얕은 네트워크 깊이, 손실값 정체, 낮은 검증 정확도 문제 발생 
   - 이를 개선하기 위해 ResNet 도입, 잔차 학습 구조로 기울기 소실 문제 완화, 깊은 네트워크 학습 가능, 복잡한 특징 효과적 학습.
- 딥러닝 기반 모델을 활용해 나이와 성별 분류 모델을 학습하고, 학습 과정에서는 손실값과 정확도 변화를 지속적으로 모니터링해 정상적으로 학습되는지 확인. 테스트셋을 별도로 분리해 모델의 최종 성능을 평가.
- 공개 데이터셋이나 자체 수집 데이터에서 특정 연령대 20대 비율이 높고, 고령층 데이터가 부족해 모델의 일반화 성능이 떨어지는 문제가 발생. 
- 성별이나 인종 등에서도 데이터 불균형이 존재하면 해당 집단에서 분류 정확도가 낮아질 수 있음.

#### 🙋최현우

- 나이 학습 모델 개발및 추론 검증 병행
    - EfficientNet B7모델 학습
    - EfficientNet B7(Teacher) → B3(Student) 전이학습(경량화)
    - Gil Levi & Tal Hassner Model 레퍼런스 모델 참조
       - 라즈베리 파이 임베딩 후 성능 확인
       - 기존 학습 모델은 특정 나이대만 추론됨
       - 레퍼런스 모델 사용시 다양한 나이대 추론 성공
    - 추론 모델 경량화 연구
       - Caffe → onnx → tensorflow 파일로 convert 수행
- FPGA이용 가속화 방법 연구
    - DPU IP를 사용하여 petalinux 이미지 bake 방안 모색
    - Vitis-AI 플랫폼
       - 학습 결과 파일 → .xmodel로 변환
       - DPU에 모델을 최적화하기 위해 양자화 및 컴파일
       - DPU IP에 최적화된 파일 생성
    - PYNQ OS
       - pynq-dpu를 이용하여 PYNQ OS에 내장된 DPU IP 사용가능
       - PYNQ-OS의 pynq-dpu와 VART를 사용하여 DPU를 이용한 추론

→ Vitis-AI 플랫폼을 이용한 .xmodel 우선 시도


## 🗓️0705-0706

#### 🙋‍♀️정은지
[07/05]
**나이 및 성별 추론 모델 학습 진행**
- 데이터셋 조정 및 모델 실험:
  - 초기 데이터셋 개수를 1,000개에서 10,000개로 증량 후, 최종적으로 2,000개로 조정하여 학습 효율성 모색.
  - 중장년층 데이터 확보를 위해 데이터셋을 변경하고, 회귀 모델과 이진 모델 간 변경을 통해 최적의 학습 방식 탐색.
  - 나이 추론 모델: VGG16, ResNet152V2, Xception 모델 적용 및 WebCam 성능 비교.
  - 성별 추론 모델: ResNet152V2, Xception, ResNet50V2 모델 적용 및 WebCam 성능 비교.
- 직면한 문제점:
  - 중장년층 나이 추론 정확도 저하: 모델이 중장년층의 나이를 제대로 추론하지 못하는 문제 발생.
- 해결 시도:
  -  데이터셋 보강: 중장년층 데이터가 더 많이 포함된 데이터셋을 확보하여 모델 성능 향상 시도.
  - 데이터 노후화 문제: 확보한 데이터셋이 오래되어 현재 중장년층 얼굴 특징과 불일치하는 문제 발생.
  - 후처리 적용: 나이 추론 결과에 대한 후처리(Post-processing)를 적용하여 정확도 개선.
  - [참고 자료](https://github.com/drgn88/ai_age_body_tablet_team4/issues/1)

[07/06]
**사진 기반 나이 추론 모델 성능 분석**
- 사진 추론 성능 문제:
  - 학습은 사진 데이터로 진행했으나, 영상 데이터를 통한 실시간 나이 추론에서는 준수한 성능을 보임.
  - 반면, 단일 사진에 대한 나이 추론 시에는 성능이 현저히 떨어지는 문제점 확인.


#### 🙋‍♂️이은성

[07/05]
Integrated Ollama, AI model 
- Ollama 대화를 통해 AI 모델 실행: 사용자 터미널에서 Ollama와의 대화를 통해 AI 모델을 실행. 사용자가 "웹캠실행"이라고 말하면 AI스크립트가 실행되어 웹캠이 켜지고, "웹캠종료"라고 말하면 웹캠이 꺼지게. 
- ASK Ollama API 생성: Ollama 모델과의 통신을 위해 ollama chat 또는 ollama gen를 사용하는 API 래퍼 함수를 생성 후 사용.
- Ollama Controller 생성: ctrl 파일은 Ollama와의 대화 및 웹캠 제어를 위한 메인 컨트롤러 생성 ->  컨트롤러는 사용자 입력에 따라 Ollama와 대화하고, Ollama의 응답 또는 사용자 발화에 특정 명령어가 포함되어 있을 경우 웹캠을 시작하거나 종료하는 기능 추가

[07/06]
Raspberry PI
- Raspberry PI Board에서 진행
- 리소스 부족 문제 발견: 라즈베리 파이와 같은 리소스가 제한적인 환경에서는 AI 모델 및 Ollama 실행 시 리소스 부족 문제가 발생. TensorFlow 및 복잡한 모델 실행 시 CPU 사용량에 대한 최적화가 필요함.
- Ollama가 답변할 때 웹캠을 닫고, 답변이 끝나면 웹캠을 다시 열도록 함.

#### 🙋최현우

[07/05]

Ultra96 V2: Vitis-AI를 활용한 xmodel 생성 시도
- darknet yolov3의 weights 및 cfg를 caffe 형식으로 변환 시도
- Vitis-ai에서 지원하는 caffe 버전이 convert 스크립트의 concat 주변 레이어 구성 지원을 하지 않음
- tensorflow 형식으로 변환 시도
- yolov3-tiny모델의 weight와 cfg 파일의 불일치 문제
  - 해당 문제로 시간 지체
- yolov3의 weight와 cfg로 변환 시도
- frozen_graph.pb 파일 생성 완료
  - 최종 양자화 단계에서 .xmodel 파일 생성 오류
  - Segmentation fault 발생
  - calibration data 및 GPU 자원 off 시도
  - 그럼에도 해결 X

[07/06]

- PYNQ OS으로 해결 시도
- DPU 사용을 위한 .xmodel 생성 시도 실패
- PYNQ OS를 사용하여 Vitis-ai가 지원하는 pynq-dpu 사용 시도
- Ultra96v2에 DPU import 성공
- Yolov3를 이용한 이미지 객체 분류 성공
- 웹캠을 이용한 실시간 객체 분류 시도
  - PYNQ OS 모니터 출력과 웹캠 모니터 출력이 겹쳐 모니 송출 문제 발생
  - HW overlay에서 해당 DP 출력 IP를 찾아 웹캠 구동 시 xwindow 종료로 설정
  - 웹캠 구동은 성공했으나 카메라 송출 속도가 너무 느림
  - 이미지로 성능 비교하기로 방향 전환
- PS(ap)로만 사용했을 때와 PL(DPU)을 같이 사용했을 때 이미지 객체 분류에서 성능 비교 성공

## 🗓️0707

#### 🙋‍♀️정은지
[07/07]<br>
**나이 및 성별 추론 모델 선정**
- 주말동안 학습시킨 모델들의 성능을 웹캠으로 비교하여 최적의 모델 선정(Age: 2000_VGG16, Gender: 10,000_RasNet152V2) / 보고서 내용 정리
- FPGA 보드와 FPS 속도를 비교하기 위한  라즈베리파이에서의  이미지 수, 총 소요 시간, 이미지당 평균 추론 시간,  초당 처리 가능한 이미지 수 (FPS), 예측의 평균 신뢰도, 예측 정확도 등 추론 예정
- FPGA 보드와 성능을 비교하기 위한 적절한 크기의 데이터셋 확보 필요


**라즈베리파이(CPU) 대비 하드웨어(FPGA DPU) 가속 효과 확인**
 
- 라즈베리파이와 FPGA 성능(FPS 속도) 비교를 위한 학습 진행
  - ResNet50 모델로 Animals-10 Data에 대한 Ubuntu, 라즈베리파이 성능 확인
  - Test용 UTKFace 데이터 준비
  - Vitis AI에서 Ultra96-V2에 제공하는 모델 라이브러리인 VGG16 모델로 새로운 Gender 학습 모델을 생성하여 Ubuntu에서의 성능을 확인함 
    - Ultra96-V2에서 VGG16 모델이 작동하지 않는(리소스 부족) 이슈 발생
    - 새로운 데이터셋으로 학습시킨 Gender model의 성능을 비교했다는 의의(ResNet152:85% 정확도, VGG16: 74%) 
       - [참고 자료](https://github.com/drgn88/ai_age_body_tablet_team4/issues/4)
    - 같은 데이터셋으로 나이 모델도 확인했지만 정확도가 높지는 않았음



#### 🙋‍♂️이은성

**리소스 최적화 문제 해결 및 시스템 안정화**
- 라즈베리 파이에서의 리소스 부족 문제에 대해 알고리즘을 새로 구현하고, 시스템 구조를 개선하여 성능을 안정화

- 라즈베리 파이는 CPU 성능이 제한적이므로, 동시에 OpenCV 기반 웹캠 영상 처리, AI 모델 추론, 그리고 Ollama 호출을 수행할 경우 리소스가 포화되어 시스템이 느려지거나 버벅이는 문제.

- Ollama로 LLM 응답을 받을 때는 웹캠을 닫고, LLM 답변 출력이 끝난 후 웹캠을 다시 활성화하도록 구조를 변경

- 추론 빈도를 1초에 30~40프레임 수준에서 10프레임 단위로 줄여서, 실시간 얼굴 인식/분류에 대한 추론 간격을 넓힘.

- 평균 CPU 사용률이 80~90% 수준으로 낮아졌으며, 시스템 강제 종료나 응답 지연 없이 안정적인 동작을 확인함.

#### 🙋최현우

- Daily Report 및 Git README 중간 정리
-  PYNQ OS ResNET50 .xmodel 생성
    - MLPerf 최적화 ResNET50 모델에 대한 xmodel 파일 생성
    - MLPerf: 머신러닝 성능 측정을 위한 벤치마크 → 최적화가 가장 잘된 모델
    - DPU의 퍼포먼스를 확인하기에 가장 최적의 모델이라 판단
- ResNET50에 대한 Class 분류 코드 작성
    - pynq-dpu를 사용하는 스크립트
    - PS만을 사용하는 스크립트
       - PS에 대한 스크립트는 모델 파일 필요
       - TF 혹은 PT에서 사전학습된 파일 사용 예정
       - Pynq에서 구동 불가 시 코랩을 통한 직접 모델 파일 생성할 것
- FPGA와 라즈베리파이 간 성능 비교를 위한 Test Sample 데이터 준비


## 🗓️0708

#### 🙋‍♀️정은지
[07/08]
**학습 모델로 사진 분류 테스트**
- 6일에 확인했듯 영상보다 사진으로 분류를 시도할 때 현저하게 성능이 감소함
  - 영상이 사진보다 판단할 데이터가 충분하기 때문에 성능이 좋은 것으로 판단됨.
  - 여러 시도를 했지만 사진 분류 시의 성능이 개선되지는 않았음.
  - 특히, 성별보다 나이에서 정확도가 떨어짐.

- UFTFace가 아닌 일반 사진으로 예측 정확도 평가 -> 나이대별 후처리 보정 작업 진행
- 후처리 보정했음에도 부족한 점
  - (1) 동서양 데이터량의 차이 <br> 서양인에게 더 적합한 모델 -> 후처리 보정 시, 기준 나이보다 서양인은 높게, 동양인은 낮게 출력됨.
  - (2) 데이터의 노후화(2016년 UTKFace 자료로 학습) <br> 같은 나이의 여성 대비 남성의 나이가 더 높게 예측 됨 -> 데이터 품질 향상 필요
  - 발표자료 참고: [link](https://github.com/drgn88/ai_age_body_tablet_team4/tree/main/presentation)

#### 🙋‍♂️이은성

- 라즈베리파이와 PC(CPU)에서 딥러닝 모델 실행 시 성능 차이를 분석하고, FPGA 기반 모델 성능 차이 측정 기준 마련

- (tensorflow의 라이브러리 resnet-50과 vgg-16 학습 모델)사용

- resnet-50과 vgg-16 학습 모델로 동물 클래스 분류하는 것을 진행하여, 모델의 신뢰도 확인 후 + resnet-50과 vgg-16 학습 모델로 성별 및 나이 분류
진행

- 각 환경에서 FPS (Frames Per Second)**와 총 처리 시간(Total Inference Time)을 측정함.


#### 🙋최현우

- ResNet50 DPU 사용했을 때 성능 비교
   - PYNQ-DPU ResNet50 .xmodel생성
   - DPU 사용 시 및 PS만 사용할 때 성능 측정
   - 우분투 PC 및 라즈베리 파이에서 성능 측정
[비교 결과]
ResNet50: https://github.com/drgn88/ai_age_body_tablet_team4/issues/2
YoloV3: https://github.com/drgn88/ai_age_body_tablet_team4/issues/3


## 🗓️0709

## 🗓️0710